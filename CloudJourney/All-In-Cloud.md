# WIP オンプレ AD を無くしたい？
## 概要
クラウド利用があたりまえの時代になり、  
「オンプレ AD を無くして、全部クラウドで管理したい」   
「いつオンプレ AD を無くせるか？」   
などのご要望・ご質問をいただく機会が多くなっています。    
これに対し、実現可否やその時期について一般化して答えるのは難しいですが、オンプレ AD に依存しているリソースが多い企業では、最終的にオンプレ AD を無くすまで、5年、10年越しのプロジェクトになるかもしれません。  
また、オンプレ AD への依存度を下げていくことで、クラウドのメリットを享受できるため、早めに計画を立てて実行していくことをお奨めします。

## 推奨事項
クラウドのみでの管理に向けた準備を進める  
* 新規導入する Windows 10 は、Azure AD Join + Intune を利用した管理をはじめる
* 新規導入するアプリケーションは、モダン認証（OpenID Connect、SAML、WS-Federation）対応を必須とする
* クラウド人事システムの検討・導入

では、どういう考え方で計画を進めていくのか、ということについてまとめます。

## オンプレ AD の役割の棚卸し
オンプレ AD への依存度を下げるにあたり、依存しているモノ（リソース）を Azure AD を中心としたクラウドサービス等に移動する必要があります。計画するには、以下のようなステップを踏みます。
1. オンプレ AD の役割を分解・整理
2. それらをクラウドで実現する場合の方法

その場合、U/D/A モデルが役に立ちます。U/D/A とは、オンプレ AD に依存している以下のリソースの頭文字を取ったものです。
* (U)ser
* (D)evice
* (A)pplication

以下、それぞれについての説明とクラウド移行後のイメージについて説明します。

## U（ユーザー）
結論から言うと、これはとても複雑で、移行までにはかなり長い年月がかかることが予想されます。

### オンプレ AD の役割
ユーザーアカウント（資格情報を含む）の管理  
グループの管理を通じて、ユーザーへのアクセス権付与を実現

多くの企業において、オンプレ AD は、ユーザーアカウントライフサイクル (作成・変更・削除) の泉源ではない場合が殆どです。たとえば、社員が入社すると、先に人事システム等にユーザーのレコードが作られ、そこから自動・手動でオンプレ AD にアカウントが作成される、というパターンです。単純化すると、以下のようなフローになるわけですが、このままではユーザープロビジョニングがオンプレ AD に依存し続けてしまいます。
 >人事システム → オンプレ AD → Azure AD   

最終的には、以下のようなフローに変更する必要があります。
 >人事システム → Azure AD

もし、人事システムに Workday や、SuccessFactors を利用している場合、Azure AD の[インバウンドプロビジョニング機能](https://docs.microsoft.com/ja-jp/azure/active-directory/saas-apps/workday-inbound-tutorial)を利用することで、これを実現可能ですが移行過渡期においては、オンプレ AD も併用する必要があるため、何らかの形でオンプレ AD へのユーザープロビジョニングも必要になるはずです。例えば以下のようなフローが実現できればベストなのかもしれませんが、これは将来的にサポートするシナリオとして検討されている段階です。
 >人事システム → Azure AD → オンプレ AD

### 考慮事項


## D (デバイス)
オンプレ AD が担っている大きな役割として、デバイス管理があります。多くの場合、Windows PC をオンプレ AD 参加 (ドメイン参加) させ、グループポリシー（GPO）で管理する、と捉えて良いはずです。
これと同等なことをクラウドで実現するには、Azure AD Join をして、GPO の代わりに Intune を利用します。  

### 考慮事項
* 対象は Window 10 のみ
  * ダウンレベル OS （Windows 7 や 8.1）、サーバー OS は Azure AD Join および Intune での管理はサポートされていません。
  * サーバー OS については、アプリケーションのセクションで詳しく触れますが、アプリケーションの移行や Azure AD Domain Services を利用します。
* オンプレ AD 参加 から Azure AD Join への移行パスは無い
  * IT 管理者による一括移行をすることができないため、エンドユーザーがオンプレ AD 参加状態を解除し、その後、Azure AD Join をするという操作が必要になります。従って、現実的には新規導入する Windows 10 デバイスから Azure AD Join + Intune を利用することを進めます。
* Hybrid Azure AD Join から Azure AD Join への移行パスは無い
  * IT 管理者による一括移行をすることができないため、エンドユーザーがオンプレ AD 参加状態を解除し、その後、Azure AD Join をするという操作が必要になります。
  * これは、Hybrid Azure AD Join をすべきではない、ということではありません。考える順番として、
  * マイクロソフトはこの移行パスの必要性や有効性を検証しています。

Azure AD Join、Hybrid Azure AD Join 等の詳しい理解については、[Azure Active Directory のデバイス管理とは](
https://docs.microsoft.com/ja-jp/azure/active-directory/devices/overview) をご覧ください。

## A (アプリケーション)


