# WIP オンプレADを無くしたい

## 概要
クラウド利用が一般化するにあたり、オンプレミスのサーバーを無くしたい、というニーズは更に高くなっています。その中でActive Directory (AD)を無くすことが可能なのか、無くすべきなのか、というようなご質問を多くいただきます。  
この答えは単純ではありません。この記事では、実際に無くすことができるのかについて、また無くすためにはどういうアプローチで考がえればよいかを取り上げます。

## Active Directory の役割
クラウド移行を考えるにあたりとても重要なのが、いま実現していることの「目的」を分解して理解しておくことです。オンプレミスで利用していたテクノロジーがそのままクラウドで利用できるとは限りません。ですが、別なアプローチで同じ目的を達成できる場合が多々あります。  
ADの役割は大きくは4つに整理できます。
1. ユーザー・グループ管理
2. ユーザー・デバイス認証
3. デバイス管理
4. アプリケーション認証・認可

## 1. ユーザー・グループ管理
ユーザーアカウントやグループの管理をします。
Azure ADでユーザーやグループを作成することで、同様な管理を実現できます。

## 2. ユーザー・デバイスの認証
ドメイン参加したWindows PCに、ADにあるユーザーアカウントでログインします。
Azure AD Joinをすることで、Azure ADのアカウントでWindows PCへログインすることが可能です。

## 3. デバイス管理
ドメイン参加したWindows PCへグループポリシーを適用し、デバイスのセキュリティレベルを構成管理に利用します。
Azure ADにはグループポリシーのようなデバイス管理の機能は実装されていません。Intune等のMDMを利用することにより、この要件を実現します。

## 4. アプリケーション認証・認可
ファイルサーバーやIIS等のアプリケーションへアクセスする際、ユーザーに応じてアクセス制御をします。その場合、アプリケーションはADを認証プロバイダとして信頼します。
Azure ADでもモダン認証(OpenID Connect, OAuth2)や、SAML2.0、WS-Federationを利用したアプリケーションの認証プロバイダとして利用可能ですが、Kerberosを使うような従来型の認証方式にはそのままでは対応していません。Azure AD Domain Servicesを利用することで既存のアプリケーション資産を利用することが可能です。


## 移行戦略
アプリケーションをクラウド化、モダン認証化  
ファイルサーバーであれば、クラウドストレージを利用  
これは、ADを無くすつもりがなくともアプリケーション更改のタイミングで検討すべき点です。  


デバイス管理をクラウドに  
PCの参加先をクラウドに  
ドメイン参加ではなく、Azure AD Joinをし、Intuneで管理という形態に移行

クラウド認証へ    
PCのの参加先をクラウドにすることで、デバイス認証のクラウド化ができます。ユーザー認証については、ADFSを利用しているケースにおいては、クラウド認証(パスワードハッシュ同期、パススルー認証)への移行を検討します。  
  
ユーザープロビジョニング  
ユーザー・グループの作成がどのように行われているか   
多くの場合、上流の人事システムからバッチでADへアカウントを作成・変更・削除、というような運用が行われているかと思います。
Workdayなどの人事SaaSアプリケーションとAzure ADを連携させることが可能です。


